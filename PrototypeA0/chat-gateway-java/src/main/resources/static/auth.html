<!DOCTYPE html>
<html>
<head>
  <title>Auth</title>
</head>
<body>

<h2>Login</h2>
<input id="loginEmail" placeholder="email">
<input id="loginPassword" placeholder="password" type="password">
<button onclick="login()">Login</button>

<h2>Register</h2>
<input id="regName" placeholder="name">
<input id="regEmail" placeholder="email">
<input id="regPassword" placeholder="password" type="password">
<button onclick="register()">Register</button>

<script>
  if (localStorage.getItem("token")) {
    window.location.href = "index.html";
  }

  async function login() {
    const email = document.getElementById("loginEmail").value;
    const password = document.getElementById("loginPassword").value;

    const res = await fetch("/users/login", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({ email, password })
    });

    if (!res.ok) {
      alert("Login failed");
      return;
    }

    const data = await res.json();

    // save token + user
    localStorage.setItem("token", data.token);
    localStorage.setItem("currentUser", JSON.stringify({
      id: data.userId,
      name: data.name
    }));

    // go to chat app
    window.location.href = "index.html";
  }

  async function register() {
    const name = document.getElementById("regName").value;
    const email = document.getElementById("regEmail").value;
    const password = document.getElementById("regPassword").value;

    const res = await fetch("/users/register", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"},
      body: JSON.stringify({ name, email, password })
    });

    if (!res.ok) {
      alert("Registration failed");
      return;
    }

    const user = await res.json();

    alert("Registered! Now log in.");

    // optionally auto-login later
    // for now just stay here
  }
</script>

</body>
</html>
