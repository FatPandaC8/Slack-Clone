syntax = "proto3";

package chat;

option go_package = ".;chatproto";

service ChatService {
  // Messages
  rpc SendMessage (SendMessageRequest) returns (SendMessageResponse);

  // Conversations
  rpc CreateConversation (CreateConversationRequest) returns (CreateConversationResponse);
  rpc GetConversation (GetConversationRequest) returns (GetConversationResponse);
  rpc ListConversations (ListConversationsRequest) returns (ListConversationsResponse);
  rpc JoinConversation (JoinConversationRequest) returns (JoinConversationResponse);

  // Users
  rpc CreateUser (CreateUserRequest) returns (CreateUserResponse);
  rpc ListUsers (ListUserRequest) returns (ListUserResponse);
}

// ---------------------- Users ----------------------
message ChatUser {
  string userId = 1;
  string name = 2;
}

message CreateUserRequest {
  string name = 1;
  string email = 2;
  string password = 3; // hash in the server
}

message CreateUserResponse {
  bool ok = 1;
  string error = 2;
  string userId = 3;
  string name = 4;
}

message ListUserRequest {
  string conversationId = 1;
}

message ListUserResponse {
  repeated ChatUser users = 1;
}

// ---------------------- Conversations ----------------------
message GetConversationRequest {
  string conversationId = 1;
}

message GetConversationResponse {
  string conversationId = 1;
  repeated ChatMessage messages = 2;
  repeated ChatUser members = 3;
}

message ChatMessage {
  string messageId = 1;
  string senderId = 2;
  string text = 3;
  string createdAt = 4; // RFC3339 format
}

message CreateConversationRequest {
  string name = 1;
  string creatorId = 2;
}

message CreateConversationResponse {
  bool ok = 1;
  string error = 2;
  string conversationId = 3;
  string inviteCode = 4;
  string name = 5;
}

message JoinConversationRequest {
  string inviteCode = 1;
  string userId = 2;
}

message JoinConversationResponse {
  bool ok = 1;
  string conversationId = 2;
  string error = 3;
}

// ---------------------- Sending Messages ----------------------
message SendMessageRequest {
  string messageId = 1; // optional, can be generated server-side
  string conversationId = 2;
  string senderId = 3;
  string text = 4;
}

message SendMessageResponse {
  bool ok = 1;
  string error = 2;
  string messageId = 3;
  string createdAt = 4; // RFC3339
}

// ---------------------- Listing Conversations ----------------------
message ConversationView {
  string conversation_id = 1;
  string name = 2;
}

message ListConversationsRequest {
  string userId = 1;
}

message ListConversationsResponse {
  repeated ConversationView conversations = 1;
}